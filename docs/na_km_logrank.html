<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Various code examples and methodologies for survival analysis">

<title>Material on Survival Analyses - Non-parametric estimators</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./cox_regr.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./na_km_logrank.html">Non-parametric estimators</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Material on Survival Analyses</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bblodfon/surv-courses/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./na_km_logrank.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Non-parametric estimators</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cox_regr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cox Regression (low-dim)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cox_regr_high_dim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cox regression (high-dim)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aalen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Additive regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mstate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multi-state models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./frailty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frailty models for clustered data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ncc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case-control studies</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#nelson-aalen-estimator" id="toc-nelson-aalen-estimator" class="nav-link active" data-scroll-target="#nelson-aalen-estimator">Nelson-Aalen estimator</a></li>
  <li><a href="#kaplan-meier-and-log-rank-test" id="toc-kaplan-meier-and-log-rank-test" class="nav-link" data-scroll-target="#kaplan-meier-and-log-rank-test">Kaplan-Meier and log-rank test</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Non-parametric estimators</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="nelson-aalen-estimator" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="nelson-aalen-estimator">Nelson-Aalen estimator</h2>
<div class="cell" data-hash="na_km_logrank_cache/html/libs_0fcf63923a96142bce8af34406dea6e1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the period 1962-77 a total of <span class="math inline">\(205\)</span> patients with <em>malignant melanoma</em> (cancer of the skin) were operated at Odense University hospital in Denmark. A number of covariates were recorded at operation, and the patients were followed up until death or censoring at the <strong>end of the study at December 31, 1977</strong>. We will study death from malignant melanoma considering death from other causes as censorings. (Source: Andersen, Borgan, Gill &amp; Keiding, Springer, 1993.)</p>
<p>You may read the data into R by the command:</p>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-1_c49c51a50a8f16dc700c5d8315a7fca9">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>melanoma <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"https://www.med.uio.no/imb/english/research/centres/ocbe/courses/imb9335/melanoma.txt"</span>,<span class="at">header=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data are organized with one line for each of the 205 patients, and with the following variables in the seven columns:</p>
<ul>
<li>status: status (1=death from disease, 2=censored, 4=death from other cause)</li>
<li>lifetime: life time from operation in years</li>
<li>ulcer: ulceration (1=present, 2=absent)</li>
<li>thickn: tumor thickness in mm</li>
<li>sex: 1=female, 2=male</li>
<li>age: age at operation in years</li>
<li>grthick: grouped tumor thickness [1: 0-1 mm (i.e.&nbsp;below 2 mm), 2: 2-4 mm (i.e.&nbsp;at least 2 mm, but below 5 mm) , 3: 5+ mm (i.e.&nbsp;5 mm or more)]</li>
</ul>
<p>The following commands provide a <strong>Nelson-Aalen plot</strong> for female melanoma patients. (The survival-library has to be loaded.)</p>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-2_3d303e7e52e1ab942788541a865b37b1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>surv.f <span class="ot">=</span> survival<span class="sc">::</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> melanoma, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> (sex <span class="sc">==</span> <span class="dv">1</span>), <span class="at">ctype =</span> <span class="dv">1</span>) <span class="co"># ctype = 1 means NA estimator</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>surv.m <span class="ot">=</span> survival<span class="sc">::</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> melanoma, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> (sex <span class="sc">==</span> <span class="dv">2</span>), <span class="at">ctype =</span> <span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.f, <span class="at">fun=</span><span class="st">"cumhaz"</span>, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">conf.type=</span><span class="st">"plain"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.80</span>), <span class="at">main=</span><span class="st">"Females"</span>, <span class="at">xlab=</span><span class="st">"Years since operation"</span>, <span class="at">ylab=</span><span class="st">"Cumulative hazard"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.m, <span class="at">fun=</span><span class="st">"cumhaz"</span>, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">conf.type=</span><span class="st">"plain"</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.80</span>), <span class="at">main=</span><span class="st">"Males"</span>, <span class="at">xlab=</span><span class="st">"Years since operation"</span>, <span class="at">ylab=</span><span class="st">"Cumulative hazard"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol type="a">
<li><p>Perform the commands and interpret the Nelson-Aalen plot.</p></li>
<li><p>Make a Nelson-Aalen plot for males and compare with the plot for females.</p></li>
</ol>
<p>To plot the Nelson-Aalen estimates for both genders in the same figure, we may give the commands:</p>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-3_1083d3938f5fa27eb5e526609d140e65">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>surv.sex <span class="ot">=</span> survival<span class="sc">::</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(sex), <span class="at">data=</span>melanoma, <span class="at">ctype=</span><span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.sex, <span class="at">fun=</span><span class="st">"cumhaz"</span>, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.80</span>), <span class="at">main=</span><span class="st">"Gender"</span>, <span class="at">xlab=</span><span class="st">"Years since operation"</span>, <span class="at">ylab=</span><span class="st">"Cumulative hazard"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="fu">c</span>(<span class="st">"Females"</span>,<span class="st">"Males"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="3" type="a">
<li>Perform the commands and inspect the plot.</li>
</ol>
<ul>
<li>Straight slope =&gt; <strong>constant hazard</strong> independent of gender</li>
</ul>
<ol start="4" type="a">
<li>Make Nelson-Aalen plots for patients with ulceration present and absent and interpret the plots. (Ulceration is “present” if the surface of the tumor viewed in a microscope show signs of ulcers and “absent” otherwise.)</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-4_a8854f7681887d4940165233e710afc4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>surv.ulcer <span class="ot">=</span> survival<span class="sc">::</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(ulcer), <span class="at">data=</span>melanoma, <span class="at">ctype=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.ulcer, <span class="at">fun=</span><span class="st">"cumhaz"</span>, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.80</span>), <span class="at">main=</span><span class="st">"Ulceration"</span>, <span class="at">xlab=</span><span class="st">"Years since operation"</span>, <span class="at">ylab=</span><span class="st">"Cumulative hazard"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="fu">c</span>(<span class="st">"Present"</span>,<span class="st">"Absent"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="5" type="a">
<li>Make Nelson-Aalen plots for the three thickness groups 0-1 mm, 2-4 mm, 5+ mm and interpret the plots.</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-5_0f70db67a83ad38de72e5bba803184a8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>surv.grthick <span class="ot">=</span> survival<span class="sc">::</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> <span class="fu">strata</span>(grthick), <span class="at">data=</span>melanoma, <span class="at">ctype=</span><span class="dv">1</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.grthick, <span class="at">fun=</span><span class="st">"cumhaz"</span>, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.80</span>), <span class="at">main=</span><span class="st">"Tumor thickness"</span>, <span class="at">xlab=</span><span class="st">"Years since operation"</span>, <span class="at">ylab=</span><span class="st">"Cumulative hazard"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="fu">c</span>(<span class="st">"0-1 mm"</span>,<span class="st">"2-4 mm"</span>, <span class="st">"5+ mm"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="kaplan-meier-and-log-rank-test" class="level2">
<h2 class="anchored" data-anchor-id="kaplan-meier-and-log-rank-test">Kaplan-Meier and log-rank test</h2>
<p>In this exercise, we will use the Kaplan-Meier estimator and the log-rank test to study survival for the melanoma patients.</p>
<p>We will consider Kaplan-Meier estimates for the mortality from malignant melanoma treating death from other causes as censoring.</p>
<p>We may compute and plot the Kaplan-Meier estimate of the survival distribution for male patients by the commands (you need to load the survival-library)</p>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-6_fb993886f24a08ada497a208a8de362d">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit.m<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>melanoma, <span class="at">subset=</span>(sex<span class="sc">==</span><span class="dv">2</span>), <span class="at">conf.type=</span><span class="st">"plain"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.m, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">"Years after operation"</span>, <span class="at">main =</span> <span class="st">"Males"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.75</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.5</span>, <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To obtain a summary of the results, you may give the command:</p>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-7_2c866fd5a32d4001215f52fb98918ba8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#?quantile.survfit</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(lifetime, status == 1) ~ 1, data = melanoma, 
    subset = (sex == 2), conf.type = "plain")

  time n.risk n.event survival std.err lower 95% CI upper 95% CI
 0.507     76       1    0.987  0.0131        0.961        1.000
 0.559     75       1    0.974  0.0184        0.938        1.000
 0.575     74       1    0.961  0.0223        0.917        1.000
 0.636     73       1    0.947  0.0256        0.897        0.998
 1.167     72       1    0.934  0.0284        0.878        0.990
 1.449     70       1    0.921  0.0310        0.860        0.982
 1.701     69       1    0.908  0.0333        0.842        0.973
 1.723     68       1    0.894  0.0354        0.825        0.964
 1.805     67       1    0.881  0.0373        0.808        0.954
 1.967     66       1    0.867  0.0390        0.791        0.944
 2.060     65       1    0.854  0.0407        0.774        0.934
 2.134     64       1    0.841  0.0422        0.758        0.923
 2.173     63       1    0.827  0.0435        0.742        0.913
 2.649     62       1    0.814  0.0448        0.726        0.902
 2.677     61       1    0.801  0.0461        0.710        0.891
 2.852     60       1    0.787  0.0472        0.695        0.880
 2.910     59       1    0.774  0.0482        0.680        0.869
 2.945     58       1    0.761  0.0492        0.664        0.857
 3.364     57       1    0.747  0.0501        0.649        0.846
 3.932     55       1    0.734  0.0510        0.634        0.834
 4.126     53       1    0.720  0.0519        0.618        0.822
 4.153     51       1    0.706  0.0528        0.602        0.809
 4.340     50       1    0.692  0.0536        0.587        0.797
 4.630     47       1    0.677  0.0544        0.570        0.784
 5.647     32       1    0.656  0.0567        0.545        0.767
 5.762     29       1    0.633  0.0591        0.517        0.749
 6.542     25       1    0.608  0.0619        0.487        0.729
 7.027     22       1    0.580  0.0650        0.453        0.708
 7.622     21       1    0.553  0.0675        0.420        0.685</code></pre>
</div>
</div>
<ol type="a">
<li>Perform these commands and interpret the Kaplan-Meier plot. Determine the lower quartile of the survival distribution for males with 95% confidence limits using the output from the summary-command. (Note that the lower quartile corresponds to 75% survival probability.)</li>
</ol>
<ul>
<li>Look at the <strong>first time</strong> the Survival probability falls below <span class="math inline">\(75\%\)</span></li>
</ul>
<ol start="2" type="a">
<li>We may obtain the quartiles of the survival distribution for males by the command</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-8_539ba738feef69d71e006dfa522f7055">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(fit.m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$quantile
      25       50       75 
3.364384       NA       NA 

$lower
      25       50       75 
2.172603 6.542466       NA 

$upper
      25       50       75 
5.761644       NA       NA </code></pre>
</div>
</div>
<p>Perform this command and compare with the result you obtained in a).</p>
<ol start="3" type="a">
<li>Make a Kaplan-Meier plot for females, and determine the lower quartile for females with 95% confidence limits (if possible). Compare with the results for males.</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-9_01cb46fc21038a4798a631064dbd0b60">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit.f<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>melanoma, <span class="at">subset=</span>(sex<span class="sc">==</span><span class="dv">1</span>), <span class="at">conf.type=</span><span class="st">"plain"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit.f, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">"Years after operation"</span>, <span class="at">main =</span> <span class="st">"Females"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(fit.f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$quantile
      25       50       75 
8.334247       NA       NA 

$lower
     25      50      75 
5.29589      NA      NA 

$upper
25 50 75 
NA NA NA </code></pre>
</div>
</div>
<ol start="4" type="a">
<li>Use the log-rank test to test the null hypothesis that males and females have the same mortality from malignant melanoma:</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-10_2388b5f8af3eae340b8a71bfd8c064a1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(lifetime,status<span class="sc">==</span><span class="dv">1</span>) <span class="sc">~</span> sex,<span class="at">data=</span>melanoma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(lifetime, status == 1) ~ sex, data = melanoma)

        N Observed Expected (O-E)^2/E (O-E)^2/V
sex=1 126       28     37.1      2.25      6.47
sex=2  79       29     19.9      4.21      6.47

 Chisq= 6.5  on 1 degrees of freedom, p= 0.01 </code></pre>
</div>
</div>
<p>What may you conclude from the test?</p>
<ol start="5" type="a">
<li>Make Kaplan-Meier plots for patients with ulceration present and absent and interpret the results. Is it possible to estimate the lower quartile for both ulceration groups? Estimate the lower quartile with confidence limits if possible. Is there a significant difference in cancer mortality for patients with ulceration present and absent?</li>
</ol>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-11_600177e1af1a060e94a1d0d8f1074194">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv.ulcer, <span class="at">mark.time=</span><span class="cn">FALSE</span>, <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">"Years after operation"</span>, <span class="at">main =</span> <span class="st">"Ulceration"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">c</span>(<span class="st">"Present"</span>,<span class="st">"Absent"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="na_km_logrank_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-12_e26bc09fc9a180eb8169123117aa6899">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(surv.ulcer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$quantile
                            25       50 75
strata(ulcer)=ulcer=1 2.690411 8.334247 NA
strata(ulcer)=ulcer=2       NA       NA NA

$lower
                            25       50 75
strata(ulcer)=ulcer=1 2.060274 4.728767 NA
strata(ulcer)=ulcer=2 7.621918       NA NA

$upper
                            25 50 75
strata(ulcer)=ulcer=1 4.126027 NA NA
strata(ulcer)=ulcer=2       NA NA NA</code></pre>
</div>
</div>
<div class="cell" data-hash="na_km_logrank_cache/html/unnamed-chunk-13_0872f8a96df7c898fabb95843934f4b2">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NO STRATA IN THE FORMULA NEEDED!</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="at">formula =</span> <span class="fu">Surv</span>(lifetime, status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">~</span> ulcer, <span class="at">data =</span> melanoma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(lifetime, status == 1) ~ ulcer, data = melanoma)

          N Observed Expected (O-E)^2/E (O-E)^2/V
ulcer=1  90       41     21.2      18.5      29.6
ulcer=2 115       16     35.8      10.9      29.6

 Chisq= 29.6  on 1 degrees of freedom, p= 5e-08 </code></pre>
</div>
</div>
<ol start="6" type="a">
<li>Make Kaplan-Meier plots for the three thickness groups 0-1 mm, 2-4 mm, 5+ mm and interpret the plots. Estimate the lower quartile with confidence limits if possible. Is there a significant difference in cancer mortality between the three thickness groups?</li>
</ol>
<ul>
<li>Same procedure as above!!!</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Intro</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./cox_regr.html" class="pagination-link">
        <span class="nav-page-text">Cox Regression (low-dim)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>